#include "echo.h"

#include <genesis.h>

static void printStatus(void)
{
    static u16 y = 1;
    u16 status = echo_get_status();
    char buffer[15];
    sprintf(buffer, "Status: %d", status);
    VDP_drawText(buffer, 1, ++y);
}

const u8 test_psg_esf[] = { 0x48, 0x08, 0x28, 0x00, 0x08, 0x38, 0x49, 0x08,
    0x29, 0x00, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08, 0x34, 0x19, 0x09, 0x04,
    0xfe, 0x0f, 0x18, 0x08, 0x30, 0x19, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08,
    0x34, 0x19, 0x09, 0x04, 0xfe, 0x0f, 0x18, 0x08, 0x38, 0x19, 0x09, 0x00,
    0xfe, 0x0f, 0x18, 0x08, 0x34, 0x19, 0x09, 0x04, 0xfe, 0x0f, 0x18, 0x08,
    0x30, 0x19, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08, 0x34, 0x19, 0x09, 0x04,
    0xfe, 0x0f, 0x18, 0x08, 0x38, 0x19, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08,
    0x34, 0x19, 0x09, 0x08, 0xfe, 0x0f, 0x18, 0x08, 0x38, 0x19, 0x09, 0x00,
    0xfe, 0x0f, 0x18, 0x08, 0x34, 0x19, 0x09, 0x08, 0xfe, 0x0f, 0x18, 0x08,
    0x38, 0x19, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08, 0x34, 0x19, 0x09, 0x08,
    0xfe, 0x0f, 0x18, 0x08, 0x30, 0x19, 0x09, 0x00, 0xfe, 0x0f, 0x18, 0x08,
    0x34, 0x19, 0x09, 0x08, 0xfe, 0x0f, 0x18, 0x19, 0xff };
const u16 test_psg_esf_len = 137;

int main()
{

    VDP_drawText("PSG Envelope Testing", 10, 1);

    const u8 psgInstrument[] = { 0xFE, 0x00, 0xFF };

    const void* const instrumentList[] = { NULL };

    printStatus();
    echo_init(instrumentList);
    VDP_waitVSync();
    printStatus();

    const u8 noteOnPsg1 = 0x08;
    const u8 note = 0x50;
    const u8 endEsf = 0xFF;

    const u8 setInstrumentPsg1 = 0x48;
    const u8 instrument = 0x00;

    const u8 setVolPsg1 = 0x28;
    const u8 loudest = 0x00;

    const u8 esf[] = { setInstrumentPsg1, instrument, setVolPsg1, loudest,
        noteOnPsg1, note, endEsf };

    echo_play_bgm(test_psg_esf);
    VDP_waitVSync();
    printStatus();

    while (TRUE) {
        VDP_waitVSync();
    }
    return 0;
}
